{% extends 'base.html' %}   

{% block title %}Sign Up{% endblock title %}

{% block body %}
<div class="container-fluid justify-content-center align-items-center py-10" style="min-height: 100vh; padding: 60px;">
    
    <div class="row w-100 d-flex justify-content-left align-items-center">
        <!-- Signup Description -->
        <div class="col-md-5 text-center p-4 shadow-lg rounded bg-white d-flex flex-column justify-content-center">
            <h1 class="fw-bold">Join Our Community</h1>
            <p class="fs-5">
                Discover a world of opportunities by joining our vibrant community.  
                Connect with like-minded individuals, access exclusive content, and take  
                your experience to the next level. Whether you're here to learn, grow, or  
                network, we have something for everyone.  
                <br><br>
                Sign up today and start your journey toward new possibilities!
            </p>
        </div>

        <!-- Decorative Divider -->
        <div class="col-md-1 d-flex justify-content-center align-items-center">
            <div class="mx-auto" style="width: 5px; height: 80%; background: #007bff; border-radius: 10px;"></div>
        </div>

        <!-- Signup Form -->
        <div class="col-md-5 px-4 py-4 shadow-lg rounded bg-light d-flex flex-column justify-content-center">
            <h2 class="text-center text-primary mb-4">Create an Account</h2>
            
            <!-- Display Messages -->
            {% if messages %}
            <div class="alert alert-danger">
                {% for message in messages %}
                    <p>{{ message }}</p>
                {% endfor %}
            </div>
            {% endif %}
            
            <form method="POST" action="/api/register/" id="register-form">
                {% csrf_token %}
                
                <div class="mb-3">
                    <label for="first_name" class="form-label">First Name</label>
                    <input type="text" class="form-control" id="first_name" name="first_name" required>
                </div>
                
                <div class="mb-3">
                    <label for="last_name" class="form-label">Last Name</label>
                    <input type="text" class="form-control" id="last_name" name="last_name" required>
                </div>
                
                <div class="mb-3">
                    <label for="user_type" class="form-label">User Type</label>
                    <select class="form-control" id="user_type" name="user_type" required>
                        <option value="">Select User Type</option>
                        <option value="freelancer">Freelancer</option>
                        <option value="organization">Organization</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>
                
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" name="password" required>
                </div>
                
                <div class="mb-3">
                    <label for="confirm_password" class="form-label">Confirm Password</label>
                    <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                </div>
                
                <button type="submit" class="btn btn-primary w-100">Sign Up</button>
            </form>
            
            <p class="text-center mt-3">
                Already have an account? <a href="{% url 'login' %}" class="text-primary">Login here</a>
            </p>
        </div>
    </div>
</div>

<script>
document.getElementById("register-form").addEventListener("submit", function(event) {
    event.preventDefault();  // Prevent form from submitting normally
    
    let formData = {
        first_name: document.getElementById("first_name").value,
        last_name: document.getElementById("last_name").value,
        user_type: document.getElementById("user_type").value,
        email: document.getElementById("email").value,
        password: document.getElementById("password").value,
        confirm_password: document.getElementById("confirm_password").value,
    };

    // Check if passwords match
    if (formData.password !== formData.confirm_password) {
        alert("Passwords do not match!");
        return;
    }
    fetch("/api/register/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify(formData)
    })
    .then(response => {
        if (!response.ok) {
            return response.text().then(text => { throw new Error(text) });
        }
        return response.json();
    })
    .then(data => {
        if (data.error) {
            alert("Error: " + data.error);
        } else {
            alert("Registration successful!");
            window.location.href = "/login/";
        }
    })
    .catch(error => {
        console.error("Error:", error);
        alert("Something went wrong. Check the console for details.");
    });        
});
</script>

{% endblock body %}
