{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock title %}

{% block body %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
  :root {
    --sidebar-bg: #212529;
    --sidebar-link: #adb5bd;
    --sidebar-link-active: #ffffff;
    --sidebar-link-hover: #ced4da;
    --content-padding: 2rem;
  }

  .sidebar {
    background-color: var(--sidebar-bg);
    min-height: 100vh;
    color: white;
    padding: 1.5rem 1rem;
  }

  .sidebar h5 {
    font-size: 1.25rem;
  }

  .sidebar .nav-link {
    color: var(--sidebar-link);
    font-weight: 500;
    transition: background-color 0.3s, color 0.3s;
  }

  .sidebar .nav-link:hover {
    color: var(--sidebar-link-hover);
  }

  .sidebar .nav-link.active {
    background-color: #495057;
    color: var(--sidebar-link-active);
    border-radius: 0.375rem;
  }

  .section-content {
    display: none;
  }

  .section-content.active {
    display: block;
  }

  .card {
    transition: transform 0.2s ease;
  }

  .card:hover {
    transform: scale(1.02);
  }

  @media (max-width: 768px) {
    .sidebar {
      min-height: auto;
      padding: 1rem;
    }

    .col-md-2,
    .col-md-10 {
      flex: 0 0 100%;
      max-width: 100%;
    }
  }
</style>

<div class="container-fluid mt-3 mb-3 px-5">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-2 sidebar" role="navigation" aria-label="Sidebar Navigation">
      <h5 class="text-center mb-4">Admin Panel</h5>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link active" href="#" data-section="users"><i class="bi bi-people-fill me-2"></i>Users</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-section="posts"><i class="bi bi-file-earmark-text me-2"></i>Posts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-section="matches"><i class="bi bi-link-45deg me-2"></i>Matches</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-section="projects"><i class="bi bi-briefcase-fill me-2"></i>Projects</a>
        </li>
      </ul>
    </nav>

    <!-- Main Content -->
    <main class="col-md-10 px-md-5 py-4" role="main">
      <h2 class="text-primary mb-4">Admin Dashboard</h2>

      <!-- Stats Cards -->
      <div class="row g-3 mb-4">
            {% for stat in stats %}
            <div class="col-sm-6 col-md-4 col-lg-2">
            <div class="card text-white bg-{{ stat.color }} shadow-sm">
                <div class="card-body text-center">
                <h6 class="card-title">{{ stat.title }}</h6>
                <p class="card-text fs-4">{{ stat.value }}</p>
                </div>
            </div>
            </div>
            {% endfor %}      
      </div>

      <!-- Users Section -->
      <section id="users" class="section-content active">
        <h3 class="mb-3">Users</h3>
        <div class="table-responsive">
          <table class="table table-hover align-middle" aria-describedby="users-section">
            <thead class="table-dark">
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>User Type</th>
                <th>Joined</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for user in users %}
              <tr>
                <td>{{ user.first_name }} {{ user.last_name }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.user_type|title }}</td>
                <td>{{ user.date_joined|date:"M d, Y" }}</td>
                <td>
                  <form method="POST" action="{% url 'admin_delete_user' user.id %}" onsubmit="return confirm('Delete this user?');">
                    {% csrf_token %}
                    <button class="btn btn-sm btn-danger">Delete</button>
                  </form>
                </td>
              </tr>
              {% empty %}
              <tr><td colspan="5">No users found.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- Posts Section -->
      <section id="posts" class="section-content">
        <h3 class="mb-3">All Posts</h3>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-dark">
              <tr>
                <th>Title</th>
                <th>User</th>
                <th>Description</th>
                <th>Created</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for post in posts %}
              <tr>
                <td>{{ post.title }}</td>
                <td>{{ post.user.email }}</td>
                <td>{{ post.content }}</td>
                <td>{{ post.created_at|date:"M d, Y" }}</td>
                <td>
                  <form method="POST" action="{% url 'admin_delete_post' post.id %}" onsubmit="return confirm('Delete this post?');">
                    {% csrf_token %}
                    <button class="btn btn-sm btn-danger">Delete</button>
                  </form>
                </td>
              </tr>
              {% empty %}
              <tr><td colspan="5">No posts found.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- Matches Section -->
      <section id="matches" class="section-content">
        <h3 class="mb-3">Match Requests</h3>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-dark">
              <tr>
                <th>Freelancer</th>
                <th>Project</th>
                <th>Status</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              {% for match in matches %}
              <tr>
                <td>{{ match.freelancer.email }}</td>
                <td>{{ match.project.project_description|truncatewords:6 }}</td>
                <td>
                  <span class="badge 
                    {% if match.status == 'pending' %}bg-warning text-dark
                    {% elif match.status == 'accepted' %}bg-success
                    {% else %}bg-danger{% endif %}">
                    {{ match.status|title }}
                  </span>
                </td>
                <td>{{ match.created_at|date:"M d, Y" }}</td>
              </tr>
              {% empty %}
              <tr><td colspan="4">No match requests found.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- Projects Section -->
      <section id="projects" class="section-content">
        <h3 class="mb-3">All Projects</h3>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-dark">
              <tr>
                <th>ID</th>
                <th>Description</th>
                <th>Organization</th>
                <th>Terms</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for project in projects %}
              <tr>
                <td>{{ project.id }}</td>
                <td>{{ project.project_description|truncatewords:10 }}</td>
                <td>{{ project.profile.company_name }} ({{ project.profile.user.email }})</td>
                <td>{{ project.terms_of_contract|truncatewords:10 }}</td>
                <td>
                  <form method="POST" action="{% url 'admin_delete_project' project.id %}" onsubmit="return confirm('Delete this project?');">
                    {% csrf_token %}
                    <button class="btn btn-sm btn-danger">Delete</button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const navLinks = document.querySelectorAll(".sidebar .nav-link");
    const sections = document.querySelectorAll(".section-content");

    navLinks.forEach(link => {
      link.addEventListener("click", function (e) {
        e.preventDefault();

        navLinks.forEach(l => l.classList.remove("active"));
        sections.forEach(sec => sec.classList.remove("active"));

        this.classList.add("active");
        const target = this.getAttribute("data-section");
        document.getElementById(target).classList.add("active");
      });
    });
  });
</script>
{% endblock body %}
