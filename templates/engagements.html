{% extends "base.html" %}
{% load static %}

{% block title %}Engagements{% endblock title %}

{% block body %}
<style>
    /* Darker background for the page */
    body {
        background-color: #f4f7fa; /* Light grey background for the whole page */
        font-family: 'Arial', sans-serif;
        color: #343a40;
        margin-bottom: 3rem;
    }

    .container {
        max-width: 900px;
        margin-top: 20px;
        margin-bottom: 20px;
        background-color: #ffffff; /* White background for container */
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* Light shadow for the container */
    }

    h2 {
        font-size: 2.5rem;
        color: #343a40;
        text-align: center;
        margin-bottom: 30px;
    }

    #posts-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .post {
        background-color: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 20px;
        position: relative;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: flex;
        flex-direction: column;
        border: 1px solid #ddd; /* Border for the cards */
    }

    .post:hover {
        transform: translateY(-10px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .post .user-info {
        font-size: 1rem;
        color: #6c757d;
        margin-bottom: 8px;
        border-bottom: 1px solid #e9ecef;
        padding-bottom: 10px;
    }

    .post .user-info .user-name {
        font-size: 1.25rem; /* Increased size for user's name */
        color: #343a40; /* Dark color for prominence */
        font-weight: bold; /* Bold for emphasis */
    }

    .post .user-info .created-at {
        font-size: 0.75rem;
        color: #adb5bd;
    }

    .post h4 {
        font-size: 1.8rem;
        color: #495057;
        margin-bottom: 15px;
        border-bottom: 1px solid #e9ecef;
        padding-bottom: 10px;
    }

    .post p {
        font-size: 1rem;
        color: #6c757d;
        line-height: 1.6;
    }

    .dropdown {
        position: absolute;
        top: 15px;
        right: 15px;
    }

    .dropdown-toggle {
        background-color: transparent;
        border: none;
        color: #007bff;
        font-size: 1.25rem;
        transition: color 0.3s ease;
    }

    .dropdown-toggle:hover {
        color: #0056b3;
    }

    .dropdown-menu {
        border-radius: 8px;
        min-width: 160px;
    }

    .dropdown-item {
        padding: 12px 18px;
        font-size: 1rem;
    }

    .dropdown-item:hover {
        background-color: #f1f1f1;
    }

    .text-muted {
        text-align: center;
        color: #6c757d;
        margin-top: 30px;
    }
</style>


<div class="container">
    <h2>Engagements</h2>
    <div id="posts-container">
        <p>Loading engagements...</p>
    </div>
</div>

<script>
    async function fetchPosts() {
        try {
            let response = await fetch("/api/posts/");
            if (!response.ok) {
                throw new Error("Failed to fetch posts");
            }

            let posts = await response.json();
            let postsContainer = document.getElementById("posts-container");
            const csrfToken = "{{ csrf_token }}"; // CSRF if needed in delete form

            postsContainer.innerHTML = ""; // Clear previous content

            if (posts.length === 0) {
                postsContainer.innerHTML = "<p class='text-muted'>No engagements found.</p>";
                return;
            }

            posts.forEach(post => {
                let postElement = document.createElement("div");
                postElement.classList.add("post");

                const createdAtDate = new Date(post.created_at);
                const formattedDate = createdAtDate.toLocaleDateString(); // Adjust date format as needed    

                let html = `
                    <div class="user-info">
                        <strong>${post.user_full_name}</strong>
                        <div class="created-at">${formattedDate}</div>
                    </div>
                    <h4>${post.title}</h4>
                    <p>${post.content}</p>
                `;

                if (post.is_owner) {
                    html += `
                        <div class="dropdown">
                          <button class="dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-three-dots-vertical"></i>
                          </button>
                          <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                              <a class="dropdown-item" href="/post/${post.id}/edit/">Edit</a>
                            </li>
                            <li>
                              <form method="POST" action="/post/${post.id}/delete/" onsubmit="return confirm('Are you sure you want to delete this post?');">
                                <input type="hidden" name="csrfmiddlewaretoken" value="${csrfToken}">
                                <button type="submit" class="dropdown-item text-danger">Delete</button>
                              </form>
                            </li>
                          </ul>
                        </div>
                    `;
                }

                postElement.innerHTML = html;
                postsContainer.appendChild(postElement);
            });

        } catch (error) {
            console.error("Error fetching posts:", error);
            document.getElementById("posts-container").innerHTML = "<p class='text-danger'>Error loading engagements.</p>";
        }
    }

    window.onload = fetchPosts;
</script>
{% endblock body %}
